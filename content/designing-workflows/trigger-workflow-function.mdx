---
title: Trigger workflow function
description: Learn more about the trigger workflow function within Knock's notification engine.
tags: ["steps", "functions"]
section: Designing workflows
---

A trigger workflow function enables you to invoke a workflow from within another workflow. This function allows you to compose complex notifications by reusing logic across multiple workflows, improving maintainability and reducing duplication.

When using the trigger workflow function, you can utilize the data passed directly from the parent workflow or specify custom data for use when triggering the nested workflow.

## How trigger functions work

The trigger workflow step functions similarly to a standard workflow trigger, executing a specified workflow with a specified payload. The payload is constructed based on the configuration settings defined in the step.

Like other functions, the trigger workflow function runs independently for each recipient in the parent workflow. This means that if your parent workflow has x number of recipients, the trigger function will execute x number of times, creating distinct workflow runs each time. This behavior ensures that each recipient's context and data is properly isolated in the nested workflow.

## Configuring a trigger function

1. Select an active workflow
    - Choose from any currently active workflows in your system
    - Ensure the workflow is committed with your intended changes
    - Note that inactive or archived workflows will fail step if used
2. Configure step settings for trigger data
    - Recipients
    - Optional: actor
    - Optional: tenant
    - Optional: data
    - Optional: cancellation key

### Selecting the workflow

You can select any *active* workflow for use in the trigger workflow step. The trigger function will always use the most recently committed version of the selected workflow. To ensure that the correct workflow version is triggered, you must commit any intended changes to the selected workflow. Any uncommitted changes to the selected workflow will not be reflected when the step is executed.

If the selected workflow is later set to inactive or is archived, the trigger workflow step will be in an invalid state and the step will be skipped.

### Setting the trigger data 

The trigger workflow function uses Liquid variables to define the trigger data for the nested workflow. You can reference any variables available in the parent workflow run.

| Field            | Type       | Default Value               | Description                                                                 |
|------------------|------------|-----------------------------|-----------------------------------------------------------------------------|
| `recipients`     | string     | `{{ recipient.id }}`        | The recipient(s) who will receive the nested workflow.                      |
| `actor`          | string     | `{{ actor.id }}`            | The user or system initiating the nested workflow.                          |
| `tenant`         | string     | `{{ tenant.id }}`           | The tenant context for the nested workflow.                                 |
| `data`           | string       | `{{ data \| json }}`      | Data payload passed to the nested workflow.                                 |
| `cancellation_key` | string   | `{{ workflow.cancellation_key }}` | Unique identifier used to cancel nested workflow runs.                      |


## Example use cases

{/* TODO */}

## Workflow cancelation

When using trigger workflow functions, both parent and nested workflows can be canceled if they contain cancelable steps (batch, delay, or fetch functions) and are configured with cancellation keys. Here's how cancellation works in nested workflows:

If the parent workflow is canceled before the trigger workflow step executes, the nested workflow will not be triggered, so no separate cancellation is needed.

If you need to cancel a nested workflow that has already been triggered, you can do so by making a separate cancellation request using the cancellation key configured in the trigger workflow step. Canceling the parent workflow after the trigger workflow step has executed will not automatically cancel the nested workflow - you'll need to cancel each workflow separately.


## Frequently asked questions

<AccordionGroup>
  <Accordion title="How are nested workflow runs tracked?">
    Each recipient run for the nested workflow step creates its own workflow run for the nested workflow. You can see these relationships in the workflow run logs.
  </Accordion>
  <Accordion title="Can I pass environment variables to nested workflows?">
    Yes, you can reference any environment variables available in the parent workflow when setting the trigger data for the nested workflow.
  </Accordion>
  <Accordion title="What happens if the nested workflow fails?">
    If a nested workflow fails, the error will be logged in the parent workflow run but won't automatically fail the parent workflow. You can use step conditions to check for and handle failures.
  </Accordion>
</AccordionGroup>