---
title: Preferences
description: Learn more about Knock's powerful preference model and see code examples to get started.
tags: ["recipients", "conditions", "prefs"]
section: Concepts
---

A [Preference](/reference#preferences) determines whether a given recipient (a user or an object) will receive a notification for a given workflow, channel, or workflow-channel pair. In this guide we'll walk through how to set notification preferences for your recipients in Knock.

## An overview of preferences

Preferences are **per-recipient rules** that tell Knock whether a notification should be delivered to a recipient based on its **channel type**, its **workflow**, and the **workflow category** that workflow belongs to (if any).

When a channel step executes in your workflow run, the recipient will only receive a notification if their preferences for the channel type, the workflow, and the workflow category all evaluate to `true`. To put this in inverse terms, if **ANY** preference related to a given channel step in a workflow evaluates to `false`, we will not send the recipient a notification. Read more about preferences evaluation [here](#evaluating-preferences).

<Callout
  emoji="❗"
  text={
    <>
      <span className="font-bold">Note:</span> if you do not set a preference
      for a given channel, workflow, or workflow category, Knock defaults them
      to <code className="font-bold">true</code>.
    </>
  }
/>

### Where preferences can be set

Preferences can be set at three different levels in Knock:

- [At the environment level](#environment-level-preference-defaults), as the default for all recipients in a given environment
- [At the tenant level](#per-tenant-preference-defaults), as the default for all recipients when a `tenant` is applied to a workflow trigger
- [At the recipient level](#recipient-preference-sets), as the default for that recipient or as per-tenant preferences for that recipient

## Types of preferences

There are three different types of preferences we can set for our recipients in Knock: **channel type** preferences, **workflow** preferences, and **workflow category** preferences. You can also use these preference types in combination with one another.

### Channel type preferences

A channel type preference lets recipients opt out of all notifications for an entire channel type, such as email. You can set preferences for all unique channel types configured within your account.

For example, if I have three configured channels of type `email`, two of type `push`, and one of type `in_app_feed`, we can set channel preferences for `email`, `push`, and `in_app_feed`.

Here's a JSON example of a given recipient's channel preferences:

```json title="Channel type preferences"
{
  "channel_types": {
    "email": false,
    "in_app_feed": true,
    "sms": true
  }
}
```

In this example the recipient wouldn't receive any notifications sent over email, as any email channel steps, regardless of their workflow or workflow category, would always evaluate to `false`.

### Workflow preferences

A workflow preference can be set for a specific workflow (e.g. a mention). When a recipient's preference for a given workflow is set to `false`, the recipient will not receive any notifications generated by that workflow across any channel type.

Here's a JSON example of a given recipient's workflow preferences.

```json title="Workflow preferences"
{
  "workflows": {
    "new-comment": true,
    "new-reply": false
  }
}
```

In this example, the recipient would not receive any notifications from the `new-reply` workflow but _would_ receive notifications from the `new-comment` workflow.

Workflow preferences are a great way to give your recipients a way to opt out of a given type of notification across all channels.

### Workflow category preferences

There are cases when you'll want to enable your recipients to set a preference for a [category](/concepts/workflows#workflow-categories) of workflows; for example, all of your workflows related to `direct` notifications. In these cases, rather than having to surface a preference control for each of those notification types, you can use `categories` to set the preference for multiple workflows at once.

Here's an example of a given recipient's preferences for a set of workflow categories:

```json title="Category preferences"
{
  "categories": {
    "direct": true,
    "following": false
  }
}
```

### Combining preferences

In many cases, you'll want to let recipients pick and choose which channels they want to be notified on about which workflows or workflow categories. This way they can opt into more disruptive channels (such as email and push) for notifications they deem important, and they can opt out of those channels on notifications they deem less important.

When you want to enable a recipient to choose which channels they'll be notified on for a given workflow or category, you can specify a `channel_types` object within both the `workflows` and `categories` preferences.

Take an example of an app that wants to give per-channel preferences to its recipients on both its `new-mention` workflow and on its `collaboration` category. In the example below, the recipient has decided they want to receive mention notifications on all channels, but collaboration notifications on just the in-app channel.

```json title="Combination preferences"
{
  "workflows": {
    "new-mention": {
      "channel_types": {
        "email": true,
        "in_app_feed": true,
        "push": true
      }
    }
  },
  "categories": {
    "collaboration": {
      "channel_types": {
        "email": false,
        "in_app_feed": true,
        "push": false
      }
    }
  }
}
```

## Recipient preference sets

A <a href="/reference#preferences"><code>PreferenceSet</code></a> is the object that stores all of a recipient's preferences. When you [set a given user's preferences](/reference#set-preferences-user) in Knock, you can either set their `default` preferences or create a `tenant`-specific preference set.

<Callout
  emoji="🔍"
  text={
    <>
      <span className="font-bold">Object preferences.</span> Although the
      following examples refer to <code className="font-bold">user</code>{" "}
      preferences, all of this information applies to{" "}
      <a href="/reference#set-preferences-object">
        <code className="font-bold">object</code> preferences
      </a>{" "}
      as well.
    </>
  }
/>

### The `default` preference set

An individual user's `default` preference set is used to define the preferences that the Knock notification engine will default to when evaluating whether to send a notification to a given user across a given channel.

The Knock notification engine uses the `default` preference set for preference evaluation when:

- No `tenant` was specified on the workflow trigger that started the workflow run
- The recipient does not have a specified preference set for the `tenant` that was provided on the workflow trigger

If your product only gives users a single set of notification preferences to configure across all tenants in your product, you'll just be using the `default` scope for your users' preferences.

<Callout
  emoji="💻"
  text={
    <>
      <span className="font-bold">Note:</span> If you're using a Knock SDK and
      don't specify an <code className="font-bold">id</code> when
      creating/updating a preference set, the{" "}
      <code className="font-bold">default</code> preference set will be used.
    </>
  }
/>

### Per-tenant preference sets

<Callout
  emoji="✨"
  text={
    <>
      <span className="font-bold">Enterprise plan feature.</span> Tenant
      preference defaults are only available on our{" "}
      <a href="https://knock.app/pricing">Enterprise plan</a>.
    </>
  }
/>

In some cases you may want to set additional preferences for a given user that pertain to a specific `tenant` within your product. A well-known example of this: in Slack, your notification preferences are set _per Slack workspace_, not as global preferences that apply across all of your Slack workspaces.

To create a preference set scoped to a particular [Tenant](/concepts/tenants), you'll set the `id` of the recipient's preference set equal to the `tenant.id`.

The Knock notification engine uses a per-tenant preference set for preference evaluation when the `recipient` of the workflow run has a preference set with an `id` equal to the `tenant.id` that is provided on the workflow trigger.

## Preference defaults

Often you'll want new users in your product to start with a default preference set that you specify. This can be done at both the environment and tenant level.

### Environment-level preference defaults

When a user is created in Knock, they are automatically opted into all channel types. This means their preference set looks like this:

```json title="Default preferences for a recipient"
{
  "id": "default",
  "workflows": null,
  "categories": null,
  "channel_types": {
    "email": true,
    "in_app_feed": true,
    "sms": true,
    "push": true,
    "chat": true
  }
}
```

In the event you need to update this set of default preferences, you can do so from the **Developers** > **Preferences** section of the dashboard. From here you can specify a default set of preferences **per environment** that will be applied to all recipients when executing a notification workflow. The default preferences set in the dashboard follow the same shape as any [preferences you set via the API](/send-notifications/setting-preferences) and will be validated before being saved.

Default preferences are useful when you need to roll out preferences across all your recipients or need to migrate recipients from one preference model to another. It's important to remember that for more complex preference migrations you may still need to update any stored preferences for your recipients, which you can do via the [batch preference update API](/reference#bulk-set-preferences).

### Per-tenant preference defaults

<Callout
  emoji="✨"
  text={
    <>
      <span className="font-bold">Enterprise plan feature.</span> Tenant
      preference defaults are only available on our{" "}
      <a href="https://knock.app/pricing">Enterprise plan</a>.
    </>
  }
/>

In some cases, you may want to extend Knock's [default preference behavior](#environment-level-preference-defaults) to your tenant admins to let them choose the notification preference defaults for users within _their_ tenants in _your_ product.

You can use tenant preference defaults to set the default preferences inherited for all recipients of a workflow triggered with a corresponding `tenant`.

<AccordionGroup>
  <Accordion title="Setting tenant default preferences">
    Tenant default preferences can be set via the API by calling the `tenants.set` method. The preferences should follow the format of a recipient <a href="/reference#preferences"><code>PreferenceSet</code></a>.

    ```javascript title="Set the default preferences for a tenant"
    const { Knock } = require("@knocklabs/node");
    const knock = new Knock(process.env.KNOCK_API_KEY);

    const preferences = {
      workflows: {
        "new-comment": {
          channel_types: {
            email: false,
            sms: true,
            chat: false,
          },
        },
      },
    };

    await knock.tenants.set("tenant-id", {
      settings: {
        preference_set: preferences,
      },
    });
    ```

  </Accordion>
  <Accordion title="Applying tenant default preferences">
    To apply tenant default preferences for a workflow run, pass a `tenant` through to your workflow trigger:

    ```javascript title="Trigger a workflow with a tenant"
    const { Knock } = require("@knocklabs/node");
    const knock = new Knock(process.env.KNOCK_API_KEY);

    await knock.workflows.trigger("workflow-name", {
      tenant: "spotify",
    });
    ```

  </Accordion>
  <Accordion title="Retrieving preferences with tenant defaults included">
    When getting a preference set for a recipient, it's also possible to pass a `tenant` parameter that will return the recipient's preference set with any tenant default preferences applied.
  </Accordion>
</AccordionGroup>

## Evaluating preferences

When a workflow is triggered, Knock will evaluate the preferences for each `recipient` of the workflow and send notifications for each channel step in the workflow based on that evaluation. There are some important rules and caveats to consider:

<AccordionGroup>
  <Accordion title="General preference rules">
    - If you do not set a preference for a given channel, workflow, or workflow category, Knock defaults them to `true`
    - A recipient's preferences will be merged against the [environment-level default](#environment-level-preference-defaults) preferences. Recipient preferences will always take precedence in the merge
  </Accordion>
  <Accordion title="Tenant-specific preference rules">
    - When executing a workflow trigger, passing in a `tenant` will automatically load that tenant's default preferences for all recipients of the workflow (if a default is set)
    - An individual recipient's tenant preferences are merged with the tenant's default preferences during workflow execution. The recipient’s tenant-specific preferences will always override the defaults set at the tenant level
    - If there is no preference default set on the `tenant` AND the recipient has no per-tenant preferences set, the recipient’s default preferences will be applied
  </Accordion>
  <Accordion title="Resolving preference conflicts">
    Sometimes a given recipient will have two or more preferences which contradict each other. Knock will only send a notification if all preference combinations that exist on the recipient evaluate to `true`.

    - A workflow can belong to multiple `categories`. Only one of those category preferences needs to evaluate to `false` for the notification not to send
    - If a workflow's parent `category` is set to `false`, the notification will not send even if a `channel_type` on the workflow is explicitly set to `true`

  </Accordion>
  <Accordion title="Debugging preferences">
    Our [Preferences API](/reference#preferences) provides endpoints for retrieving all of the preferences that have been set on a recipient.

    You can also use the [workflow debugger](/send-notifications/debugging-workflows) in your dashboard to view the preferences that were evaluated for the recipient on a given workflow run.

    <Image
      src="/images/concepts/preferences/workflow-preferences-evaluation.png"
      alt="An image of a workflow run's evaluated preferences"
      width={500}
      height={381}
      className="mx-auto rounded-md border border-gray-200 shadow-md"
    />

  </Accordion>
</AccordionGroup>

###

## Advanced preferences topics

When working with preferences, you'll sometimes run into advanced use cases where you need to provide even more granular preference options for your customers.

### Preference conditions

Preference conditions are [Knock condition models](/send-and-manage-data/conditions) that are evaluated when computing the current state of your preferences during workflow execution.

Typically, preferences evaluate to boolean values representing if your recipient has opted in or out of receiving notifications on a given channel, workflow, or category. With preference conditions, you can add additional custom expressions to that set, where the notification is only sent if all preferences (including the preference condition statement) evaluate to `true`.

Below is an example of a workflow preference that has conditions applied to determine if the preference is `true` or `false`:

```json title="An example of preferences with conditions"
{
  "id": "default",
  "workflows": {
    "dinosaurs-loose": {
      "conditions": [
        {
          "variable": "recipient.muted_dinos",
          "operator": "not_contains",
          "argument": "data.dino"
        }
      ]
    }
  }
}
```

<br />

<AccordionGroup>
  <Accordion title="Where can I use preference conditions?">
    A condition can be applied at different points in the preference set:

    - Inside `workflows`, `categories`, or `channel_types` preferences
    - Inside an individual `workflows[workflow].channel_types` preference
    - Inside an individual `categories[category].channel_types` preference

    See our guide on [setting and managing preferences](/send-notifications/setting-preferences#setting-preferences-with-conditions) for more details on how to manage preference conditions via the Knock API and SDKs.

  </Accordion>
  <Accordion title="Debugging preference conditions">
    Knock will capture conditions evaluation details for all preference conditions resolved while executing your workflows. See the [guide on debugging conditions](/send-and-manage-data/conditions#debugging-conditions) for more info.
  </Accordion>
</AccordionGroup>

### Overriding recipient preferences

Sometimes you may want to override a recipient's notification preferences in order to send notifications like a password reset email, regardless of whether the recipient has opted out of receiving emails. To do this, go to your workflow, click "Manage workflow", and enable "Override recipient preferences". You will need to commit this change for it to take effect.

When enabled, the workflow will send to all of its channels, regardless of the recipient's preferences.
