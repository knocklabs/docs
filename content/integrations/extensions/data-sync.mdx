---
title: Data warehouse sync
description: Sync notification analytics data from Knock into your own data warehouse
layout: integrations
section: Integrations > Extensions
---

You can bring your notification analytics from Knock into your own data warehouse so that you can analyze it alongside the rest of your data. To set up this sync, please contact our [support team](mailto:support@knock.app).

<Callout
  emoji="âœ¨"
  text={
    <>
      <span className="font-bold">Enterprise plan feature.</span> Data warehouse
      sync is available exclusively with our{" "}
      <a href="https://knock.app/pricing">Enterprise plan</a>.
    </>
  }
/>

## How it works

Knock leverages [Prequel](https://www.prequel.co/) to integrate with your data warehouse. There is no self-service UI to connect your account to start receiving data; instead when you contact us to set up a sync we'll send you a secure link to fill in the information about your data warehouse. Once it's connected, you'll begin receiving a [backfill of historical data](https://docs.prequel.co/docs/transfer-logic#backfills--full-refreshes), and then going forward you will receive the most up to date data on an ongoing basis.

## Setup

First, you'll have to give Knock your database type and host destination address for your data warehouse. The databases supported as destinations for Knock are [those listed on Prequel](https://docs.prequel.co/docs/destinations-overview).

Next, Knock generates a magic link you'll fill out. See what information you'll need for your particular database [here](https://docs.prequel.co/reference/post_import-magic-links).

Once the information is filled out, Prequel will provide you with a table definition. Additionally, you can run a test connection to make sure it's wired up. If it's successful, you can save it and it will proceed with the backfill transfer.

## Available data

### Messages table

Our data warehouse connector syncs data from our `messages` table. Each `message` represents a notification that was executed for a single recipient. You can read more about messages as a concept [here](https://docs.knock.app/send-and-manage-data/messages).

Below is a description of the columns included in the table and the data type of each. To see how this data type will map onto the data types of your destination table, check the [destination type mapping](https://docs.prequel.co/docs/data-types#destination-type-mapping) in the Prequel docs.

<AccordionGroup>
<Accordion title="Table definition example">
    Please note that the table name will vary based on the name of the schema provided when filling out the form.
    ```sql
        CREATE TABLE <name of schema>.messages (
          message_id character varying(65535) NOT NULL ENCODE raw distkey,
            account_id character varying(65535) ENCODE lzo,
            environment_id character varying(65535) ENCODE lzo,
            environment_name character varying(65535) ENCODE lzo,
            environment_slug character varying(65535) ENCODE lzo,
            channel_id character varying(65535) ENCODE lzo,
            channel_name character varying(65535) ENCODE lzo,
            channel_key character varying(65535) ENCODE lzo,
            channel_type character varying(65535) ENCODE lzo,
            channel_provider character varying(65535) ENCODE lzo,
            workflow_id character varying(65535) ENCODE lzo,
            workflow_key character varying(65535) ENCODE lzo,
            combined_trigger_data character varying(32768) ENCODE lzo,
            step_ref character varying(65535) ENCODE lzo,
            recipient_id character varying(65535) ENCODE lzo,
            recipient_type character varying(65535) ENCODE lzo,
            tenant_id character varying(65535) ENCODE lzo,
            exec_mode character varying(65535) ENCODE lzo,
            message_status character varying(65535) ENCODE lzo,
            inserted_at timestamp with time zone ENCODE az64,
            updated_at timestamp with time zone ENCODE raw,
            seen_at timestamp with time zone ENCODE az64,
            read_at timestamp with time zone ENCODE az64,
            clicked_at timestamp with time zone ENCODE az64,
            interacted_at timestamp with time zone ENCODE az64,
            archived_at timestamp with time zone ENCODE az64,
            has_been_seen bigint ENCODE az64,
            has_been_read bigint ENCODE az64,
            has_been_clicked bigint ENCODE az64,
            has_been_interacted bigint ENCODE az64,
            has_been_archived bigint ENCODE az64,
            PRIMARY KEY (message_id)
        ) DISTSTYLE KEY SORTKEY (message_id, updated_at);
    ```
  </Accordion>
  <Accordion title="Messages table structure">
  See possible [engagement statuses](/send-notifications/message-statuses#engagement-status) for a message.

    <Table
      headers={["Name", "Type", "Description"]}
      rows={[
        [
          "message_id",
          "string",
          "The unique identifier for this message and the primary key for this table",
        ],
        ["account_id", "string", "The UUID of the message's account"],
        ["environment_id", "string", "The UUID of the message's environment"],
        ["environment_name", "string", "The name of the message's environment"],
        ["environment_slug", "string", "The slug of the message's environment"],
        ["channel_id", "string", "The UUID of the channel the message was sent on"],
        [
          "channel_key",
          "string",
          "The unique key of the channel the message was sent on",
        ],
        [
          "channel_name",
          "string",
          "The name of the channel the message was sent on",
        ],
        [
          "channel_provider",
          "string",
          "The provider for the channel the message was sent on",
        ],
        ["channel_type", "string", "The type of channel the message was sent on"],
        [
          "workflow_id",
          "string",
          "The UUID of the version of the workflow that the message belongs to",
        ],
        [
          "workflow_key",
          "string",
          "The unique key of the workflow the message belongs to",
        ],
        [
          "combined_trigger_data",
          "json",
          <div key="combined_trigger_data_body">
            Combined and truncated trigger data for the workflow run that generated the message, at the time the message was created. See the <a target="_blank" rel="noreferrer" href="/reference#trigger-data-filtering">trigger data filtering guide</a> for more info.
          </div>
        ],
        [
          "step_ref",
          "string",
          "The reference of the step on the workflow that the message belongs to",
        ],
        ["recipient_id", "string", "The ID of the recipient for the message"],
        [
          "recipient_type",
          "string",
          <div key="recipient_type_body">
            The{" "}
            <a
              target="_blank"
              rel="noreferrer"
              href="/send-and-manage-data/recipients"
            >
              type of recipient for the message
            </a>
            , can be a user or an object
          </div>,
        ],
        ["tenant_id", "string", "The tenant associated with this message"],
        [
          "exec_mode",
          "string",
          <div key="exec_mode_body">
            The execution mode of the workflow. Possible values are:
            <ul>
              <li>
                <code>trigger</code> - from the API
              </li>
              <li>
                <code>rehearse</code> - test run
              </li>
              <li>
                <code>rehearse_step</code> - test run a single step
              </li>
              <li>
                <code>integration</code> - from an event integration source
              </li>
              <li>
                <code>scheduled</code> - previously scheduled execution
              </li>
            </ul>
          </div>,
        ],
        [
          "message_status",
          "string",
          <div key="message_status_body">
            The latest{" "}
            <a
              target="_blank"
              rel="noreferrer"
              href="/send-notifications/message-statuses#delivery-status"
            >
              delivery status of a message
            </a>
            .
          </div>,
        ],
        [
          "inserted_at",
          "timestamp",
          "The timestamp of when the message was created",
        ],
        [
          "updated_at",
          "timestamp",
          "The timestamp of when the message was last updated",
        ],
        [
          "archived_at",
          "timestamp",
          "The timestamp of when the message was archived",
        ],
        ["seen_at", "timestamp", "The timestamp of when the message was seen"],
        ["read_at", "timestamp", "The timestamp of when the message was read"],
        [
          "clicked_at",
          "timestamp",
          "The timestamp of when a link in the message was clicked",
        ],
        [
          "interacted_at",
          "timestamp",
          "The timestamp of when the message was interacted with",
        ],
        [
          "has_been_seen",
          "integer (0 = false, 1 = true)",
          "Whether the message has been seen",
        ],
        [
          "has_been_read",
          "integer (0 = false, 1 = true)",
          "Whether the message has been read",
        ],
        [
          "has_been_clicked",
          "integer (0 = false, 1 = true)",
          "Whether a link in the message has been clicked",
        ],
        [
          "has_been_interacted",
          "integer (0 = false, 1 = true)",
          "Whether the message has been interacted with",
        ],
        [
          "has_been_archived",
          "integer (0 = false, 1 = true)",
          "Whether the message has been archived",
        ],
      ]}
    />

  </Accordion>
</AccordionGroup>

### Recipient change stream table

<Callout
  emoji="ðŸ‘‰"
  text={
    <>
      <strong>Note:</strong> at this time, the recipient change stream table
      contains only users. Please{" "}
      <a href="mailto:support@knock.app">contact us</a> if you need to sync
      other recipient types.
    </>
  }
/>

Our data warehouse connector syncs data from our `recipients` table. Each row captures the properties and preferences of a [Recipient](https://docs.knock.app/send-and-manage-data/recipients) at a given moment in time.

Each row has an `event_type` indicating how the event was generated. Possible values are:

- `recipient.created` - indicates the first time a recipient was identified
- `recipient.snapshot` - is emitted every time a recipient's properties or preferences are updated, and contains the complete set of properties and preferences at that moment in time. This event may also be generated manually for all or a subset of recipients (by ID) by contacting support.
- `recipient.deleted` - contains no properties or preferences, but indicates when a recipient was deleted. A recipient may be re-identified after being deleted, which will generate another recipient.created event

Events in the recipient change stream table are retained for 7 days.

Below is a description of the columns included in the table and the data type of each. To see how this data type will map onto the data types of your destination table, check the [destination type mapping](https://docs.prequel.co/docs/data-types#destination-type-mapping) in the Prequel docs.

<AccordionGroup>
<Accordion title="Table definition example">
    Please note that the table name will vary based on the name of the schema provided when filling out the form.
    ```sql
        CREATE TABLE <name of schema>.recipient_change_stream (
          id character varying(65535) NOT NULL ENCODE raw distkey,
            account_id character varying(65535) ENCODE lzo,
            environment_id character varying(65535) ENCODE lzo,
            environment_name character varying(65535) ENCODE lzo,
            environment_slug character varying(65535) ENCODE lzo,
            recipient_id character varying(65535) ENCODE lzo,
            recipient_type character varying(65535) ENCODE lzo,
            event_Type character varying(65535) ENCODE lzo,
            properties json ENCODE lzo,
            preferences json ENCODE lzo,
            timestamp timestamp with time zone ENCODE az64,
            PRIMARY KEY (id)
        ) DISTSTYLE KEY SORTKEY (id, timestamp);
    ```
  </Accordion>
  <Accordion title="Recipient change stream table structure">
    <Table
      headers={["Name", "Type", "Description"]}
      rows={[
        ["id", "string", "Unique event ID. Can be used to deduplicate events."],
        ["account_id", "string", "The UUID of the recipient's account"],
        ["environment_id", "string", "The UUID of the recipient's environment"],
        ["environment_name", "string", "The name of the recipient's environment"],
        ["environment_slug", "string", "The slug of the recipient's environment"],
        ["recipient_id", "string", "The ID of the recipient for the message"],
        ["recipient_type", "string",
            <div key="recipient_type_body">
              The <a target="_blank" rel="noreferrer" href="https://docs.knock.app/send-and-manage-data/recipients"> type of recipient recorded</a>
            </div>,
        ],
        ["event_type", "string",
            <div key="event_type_body">
              Possible values are:
              <ul>
                <li><code>recipient.created</code> - indicates the first time a recipient was identified</li>
                <li><code>recipient.snapshot</code> - is emitted every time a recipient properties or preferences are updated, and contains the complete set of properties and preferences at that moment in time</li>
                <li><code>recipient.deleted</code> - contains no properties or preferences, but indicates when a recipient was deleted. A recipient may be re-identified after being deleted, which will generate another recipient.created event</li>
              </ul>

              A manual snapshot of the current state of all or a subset of recipients (by ID) can be made by contacting support.
            </div>,
        ],
        ["properties", "json",
            <div key="properties_body">
              All properties currently assigned to the recipient. Will be empty for <code>recipient.deleted</code>.
            </div>,
        ],
        ["preferences", "json",
            <div key="preferences_body">
              All preference sets currently assigned to the recipient, keyed by preference set ID. Will be empty for <code>recipient.deleted</code>.
            </div>,
        ],
        ["timestamp", "timestamp", "The timestamp of when the event was emitted."]
      ]}
    />

  </Accordion>
</AccordionGroup>
