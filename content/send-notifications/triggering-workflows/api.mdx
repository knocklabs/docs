---
title: Triggering workflows via the API
description: Learn more about how to trigger cross-channel notification workflows in Knock via the API.
tags: ["trigger", "notify", "data", "actor"]
section: Send notifications
---

Triggering workflows by the trigger API endpoint is the most common and most direct way to execute your workflows for your recipients. Calling the `trigger` endpoint tells Knock to run a specified payload of [Recipients](/concepts/recipients) and `data` through the workflow specified by the call.

<MultiLangCodeBlock
  snippet="workflows.trigger"
  title="Trigger a Knock workflow"
/>

Learn more about triggering workflows in [our API reference](/reference#workflows).

## Trigger payload

| Property         | Type                  | Description                                                                                                 |
| ---------------- | --------------------- | ----------------------------------------------------------------------------------------------------------- |
| key\*            | string                | The human-readable key of the workflow from the Knock dashboard                                             |
| actor            | RecipientIdentifier   | An identifier of who or what performed this action (optional)                                               |
| recipients\*     | RecipientIdentifier[] | One or more recipient references of who/what to notify for this workflow                                    |
| data             | map                   | A map of properties that are required in the templates in this workflow                                     |
| cancellation_key | string                | A unique identifier to reference the workflow when canceling                                                |
| tenant           | string                | An optional identifier of the owning tenant object for the notifications generated during this workflow run |

## Recipient identifiers

When you want to identify a recipient in a workflow, either as an actor or as a recipient you can send either:

- A string indicating a user that you have previously identified to Knock (e.g. `user-1`).
- A reference of an object that you have previously set within Knock (e.g. `{ id: "project-1", collection: "projects" }`).
- A complete `Recipient`, to be identified inline during the workflow execution.

## Response

Triggering a workflow will always return a unique UUID v4 representing the workflow run.

```json title="Trigger workflow response"
{
  "workflow_run_id": "05f8a70d-e42a-46dc-86fa-aada5752f6cf"
}
```

<br />

<Callout
  emoji="ðŸ’¡"
  text={
    <>
      Note: a workflow run ID is a unique identifier that represents the
      workflow run for all recipients of the workflow. Each individual in the
      workflow run will have a unique workflow recipient run ID, which is
      derived from the workflow run id.
    </>
  }
/>

## Passing data to your trigger

You can also pass the schema data required by the workflow into the `trigger` call. The payload must be a valid JSON object, with nested objects and arrays supported.

The data requirements for the payload are determined in the workflow builder, including indicating which keys are required.

<Callout
  emoji="ðŸ’¡"
  text={
    <>
      For more information on validating trigger data and working with JSON
      schemas, see our guide on{" "}
      <a href="/developer-tools/validating-trigger-data">
        validating trigger data
      </a>
      .
    </>
  }
/>

## Attributing the action to a user or object

Knock supports passing an `actor` in your workflow trigger calls, which allows you to attribute the workflow trigger to an individual recipient (user or object).

<MultiLangCodeBlock
  snippet="workflows.trigger-with-actor"
  title="Triggering a Knock workflow with an actor"
/>

Calling a workflow trigger with an actor will have the following effect:

- The `actor` property will be available within your message templates including the full user or object that performed this action.
- When the `actor` is also a [subscriber](/concepts/subscriptions) to an Object recipient, they are **always** excluded from the `recipients` list. No notification will be sent to the subscribed `actor`.
- When a workflow includes a [batch step](/designing-workflows/batch-function), the `actor` will be recorded as one actor who performed an action in the batch, which you can access via the `actors` key in your template.
- Any workflows that contain an in-app feed channel step will produce a message that links the actor, and the actor will be loaded in any requests to this feed.

## Generating a cancellation key

Each `trigger` call can optionally include a `cancellation_key` that allows you to uniquely identify
it when canceling. Providing your own cancellation key means that you don't need to keep track of
the Knock internal identifiers generated when calling `trigger`.

You can read more about canceling workflows [in our guide](/send-notifications/canceling-workflows).

**Keep the following in mind when generating a cancellation key:**

1. Provide a value that allows you to uniquely identify the trigger run for the batch of recipients.
   A good example in an invite notification is the `id` of a user invite so that we can easily stop reminders
   for that invite once a user has accepted it.

2. The cancellation key represents the workflow _run_, not the notifications generated per recipient, so
   you usually don't need to include a recipient identifier within the `cancellation_key`.

3. The cancellation key is _scoped per workflow_ so you don't need to include the workflow key
   in the cancellation key.

## Identifying recipients inline

You can pass a complete `Recipient` entity to the `recipients` or `actor` property when triggering a workflow. When passing the recipient, the recipients will be guaranteed to be identified **before** the workflow is triggered for the recipient with the properties passed in.

| Property        | Description                                                                                            |
| --------------- | ------------------------------------------------------------------------------------------------------ |
| `id`            | Required. An identifier for this user or object                                                        |
| `collection`    | Required when identifying an object. Indicates the collection the object belongs to                    |
| `channel_data`  | A dictionary containing a `channelId` key and a dictionary of channel data to be set for the recipient |
| `preferences`   | A dictionary containing a preference set ID key and a `PreferenceSet` object to set for the recipient  |
| `$trigger_data` | Any recipient-specific trigger data to merge in with the `data` available on the workflow run          |
| \*              | An arbitrary set of key/value pairs to set for the recipient                                           |

```json title="Example inline recipient definition"
{
  "id": "user-1",
  "name": "Jean Luc-Picard",
  "email": "jpicard@starfleet.org",
  "channel_data": {
    "4672d685-c586-4ec6-ad88-52185262af97": {
      "tokens": ["apns-push-token"]
    }
  },
  "preferences": {
    "default": {
      "channel_types": {
        "email": true,
        "sms": false
      }
    }
  }
}
```

## Per-recipient trigger data

You can pass per-recipient data to your trigger by passing a dictionary of data under the `$trigger_data` property for each recipient. Any data provided under this property will be merged with the data passed in the `data` property to produce the final data available for the recipient's workflow run.

```json title="Example per-recipient data"
{
  "data": {
    "role": "Lieutenant"
  },
  "recipients": [
    {
      "id": "jeanluc",
      "name": "Jean-Luc Picard",
      "$trigger_data": {
        "role": "Captain"
      }
    }
  ]
}
```

## Multi-tenancy in notifications

You can optionally pass a `tenant` to your `trigger` call. If you are a product that allows users to belong to multiple tenants,
you'll want to pass a `tenant` to Knock in your trigger calls so that you can make sure a given user's in-app feed is scoped to the
tenants to which they belong in your product.

You can read more about [supporting multi-tenancy in our guide](/concepts/tenants).

## Frequently asked questions

<AccordionGroup>
  <Accordion title="How do I trigger a workflow for a single recipient?">
    You can trigger a workflow for a single recipient by passing a single
    recipient identifier to the `recipients` property in your trigger call.
  </Accordion>
  <Accordion title="How do I trigger a workflow for multiple recipients?">
    You can trigger a workflow for multiple recipients by passing an array of
    recipient identifiers to the `recipients` property in your trigger call.
  </Accordion>
  <Accordion title="How do I trigger a workflow for an object?">
    You can trigger a workflow for an object by passing an object identifier to
    the `recipients` property in your trigger call.

    An object identifier looks like:

    ```json
    {
      "id": "project-1",
      "collection": "projects"
    }
    ```

  </Accordion>
  <Accordion title="How do I trigger a workflow for the subscribers of an object?">
    You can trigger a workflow for the subscribers of an object by passing an object identifier to the `recipients` property in your trigger call. Knock will automatically create a workflow run for each subscriber of the object.

    <MultiLangCodeBlock

snippet="workflows.trigger-with-object-as-recipient"
title="Workflow trigger with an object as a recipient"
/>

  </Accordion>
  <Accordion title="How do I trigger a workflow for an audience?">
    It's not yet possible to trigger a workflow for an audience via the API. If you're looking to trigger a workflow for a specific audience, please get in touch with us. We're currently considering how to best support this use case and would love to discuss your specific needs.
  </Accordion>
  <Accordion title="What's the maximum number of recipients I can trigger a workflow for?">
    You can trigger a workflow for up to 1000 recipients at a time. If you need to manage a larger list of recipients, you might want to consider using our [subscriptions feature](/concepts/subscriptions) to have Knock manage the set of recipients who need to be notified instead.
  </Accordion>
  <Accordion title="Can I bulk trigger workflows?">
    It's not currently possible to issue bulk trigger requests to the API. If you need to trigger workflows for multiple recipients with per-recipient data, you can pass per-recipient trigger data.
  </Accordion>
  <Accordion title="How do I cancel a workflow run?">
    You can cancel a workflow run by calling the `cancel` endpoint.

    <MultiLangCodeBlock
      snippet="workflows.cancel"
      title="Cancel a workflow run"
    />

  </Accordion>
  <Accordion title="Can I validate the data I'm passing to a workflow trigger?">
    Yes, you can [validate the data you're passing to a workflow trigger](/developer-tools/validating-trigger-data) by
    providing a JSON schema in your workflow trigger step.
  </Accordion>
</AccordionGroup>
