---
title: Fetch function
description: Learn more about the fetch workflow function within Knock's notification engine
tags: ["steps", "fetch", "request", "http", "functions"]
section: Send notifications
---

A fetch function executes an HTTP request as a step in a workflow. Any data returned to a fetch function is merged into the original notify `data` provided on worklfow trigger and made available to all subsequent steps in the workflow.

With the fetch function, you can acquire additional data for your channel step templates that may not be immediately available when you first trigger a workflow. A common case is combining a fetch function with a [batch function](/send-notifications/designing-workflows/batch-function) to retrieve notify data for a group of activities after a batch window has closed. You can also use the fetch function to trigger side effects in your systems as Knock processes your workflow.

## Building a request

Like with channel steps, you use the Knock template editor to configure the shape of your request. For each fetch step, you can edit the following attributes:

- **Request method** - You can select one of `GET` (the default), `POST`, or `PUT`.
- **URL** - A valid HTTP URL.
- **Headers** - Any headers Knock should include in the request. You manage these via a key-value editor, with the key being the header name and the value being the header value.
- **Query parameters** - Any query parameters to encode into the URL. You also manage these via a key-value editor.
- **Request body** - When building a `POST` or `PUT` request, you can build a request body to include in the request. Knock will always encode the request body as JSON.

![Using the request template editor to configure a fetch function.](/images/functions/functions_fetch_editor.png)

<figcaption>
  Using the request template editor to configure a fetch function.
</figcaption>

Aside from the request method selector, each of the above fields is a Liquid-compatible input. This means you can use Liquid variables and control flow to inject variable data, access Knock-controlled workflow state attributes (e.g., `actor`), and dynamically shape of the request per-workflow.

See the [Knock template editor reference](/send-notifications/designing-workflows/template-editor) for more a detailed guide on working with Liquid templates in Knock.

## Request execution

When executing the request for a fetch function, Knock expects the following from your service:

- The response to the request is one of: `200 OK`, `201 Created`, or `204 No Content`.
- If the request response contains data, it's encoded as JSON and can be decoded into a map/dictionary/hash.
- The request responses takes no longer than 15 seconds.

### Merging data

When the response sent to Knock for a fetch function request contains JSON data, Knock will merge the decoded result into the `data` you originally passed to [the workflow trigger call](/send-notifications/triggering-workflows). Knock uses a shallow-merge strategy here where:

- Data from the request overwrites the original workflow run data.
- Top-level attributes are merged, and nested attributes are completely overwritten.

_The merged data result from a fetch function step then becomes the global notify data for all subsequent steps in the workflow run._

The example below illustrates how this could look in practice.

```json Example response data merge for fetch function steps
// Original notify data
{
  "foo": "bar",
  "metadata": {
    "count": 1
  }
}

// Fetch function response data
{
  "biz": "baz",
  "metadata": {
    "query_count": 1
  }
}

// Merge result
{
  "foo": "bar",
  "biz": "baz",
  "metadata": {
    "query_count": 1
  }
}
```

### Error handling

Knock will automatically retry request execution for a fetch function following certain types of errors. The first retry will be delayed by 30 seconds, and the second by 60 second. These retryable errors are:

- **Server errors** - Any `5xx` level HTTP error code.
- **Request timeouts** - This is any fetch function request from Knock that does not receive a completed response within the 15 second limit.

All other errors or unexpected responses are immediately fatal. These include:

- Any other HTTP response code.
- Some issue with the structure of the request, such as an invalid URL.
- Any issue JSON-encoding a request body.
- Response data that cannot be JSON-decoded as expected.

After two failed retries for a retryable error or any non-retryable error, Knock will mark the fetch function step as a failure and halt your workflow run.

## Debugging fetch functions

You can use the workflow run logs to debug your fetch function steps. For each fetch function, you can expect to see in the logs:

- The request URL (with encoded query parameters), headers, and body as sent by Knock.
- The duration of the request (in milliseconds).
- The response headers and body data.

In the workflow run overview, you can also expect to see highlighted any data that Knock successfully received from any fetch function steps and merged into workflow run state.

![Viewing log details for a successful fetch function step.](/images/functions/functions_fetch_success.png)

<figcaption>
  Viewing log details for a successful fetch function step.
</figcaption>


If the request encounters an error, you can also expect to see details about the error in the logs. And finally, if the fetch function retries the request on a retryable error, you can expect to see details enumerated for each request attempt.

![Viewing log details for an unsuccessful fetch function step.](/images/functions/functions_fetch_error.png)

<figcaption>
  Viewing log details for an unsuccessful fetch function step.
</figcaption>
